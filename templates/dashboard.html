<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Labor Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container-fluid mt-4">

    <!-- HEADER -->
    <div class="row mb-3">
        <div class="col">
            <h2>Labor Dashboard</h2>
        </div>
        <div class="col text-end">
            <a href="/add" class="btn btn-primary">+ Add Employee</a>
        </div>
    </div>

    <!-- REMINDERS -->
    {% if reminders %}
    <div class="alert alert-warning">
        <strong>Reminder:</strong>
        <ul class="mb-0">
            {% for emp in reminders %}
            <li>
                {{ emp.Name }} ({{ emp.Position }}, {{ emp.Company }})
                work permit expires in {{ emp.days_left }} days ({{ emp.Expiry }})
            </li>
            {% endfor %}
        </ul>
    </div>
    {% else %}
    <div class="alert alert-success">
        All work permits are renewed ðŸŽ‰
    </div>
    {% endif %}

    <div class="row">

        <!-- COMPANY LIST -->
        <div class="col-md-3">
            <div class="list-group">
                <a href="/" class="list-group-item list-group-item-action
                {% if not selected_company %}active{% endif %}">
                    All Companies
                </a>

                {% for company in companies %}
                <a href="/company/{{ company }}"
                   class="list-group-item list-group-item-action
                   {% if selected_company == company %}active{% endif %}">
                    {{ company }}
                </a>
                {% endfor %}
            </div>
        </div>

        <!-- TABLE -->
        <div class="col-md-9">
            <table class="table table-bordered table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Company</th>
                        <th>Name</th>
                        <th>Position</th>
                        <th>Expiry</th>
                        <th>Days Left</th>
                        <th>Status</th>
                        <th>Email</th>
                        <th>WhatsApp</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>

                {% set found = false %}
                {% for company, employees in company_map.items() %}
                    {% for emp in employees %}
                        {% set found = true %}
                        <tr
                          {% if emp.status == "Expired" %} class="table-danger"
                          {% elif emp.status == "Expiring Soon" %} class="table-warning"
                          {% endif %}
                        >
                            <td>{{ emp.Company }}</td>
                            <td>{{ emp.Name }}</td>
                            <td>{{ emp.Position }}</td>
                            <td>{{ emp.Expiry }}</td>
                            <td>{{ emp.days_left }}</td>
                            <td>
                                <span class="badge
                                {% if emp.status == 'Expired' %}bg-danger
                                {% elif emp.status == 'Expiring Soon' %}bg-warning text-dark
                                {% else %}bg-success{% endif %}">
                                    {{ emp.status }}
                                </span>
                            </td>
                            <td>{{ emp.Email }}</td>
                            <td>{{ emp.WhatsAppNumber }}</td>
                            <td>
                                <a href="/edit/{{ emp.Company }}/{{ emp.Name }}"
                                   class="btn btn-sm btn-warning">
                                    Edit
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                {% endfor %}

                {% if not found %}
                <tr>
                    <td colspan="9" class="text-center text-muted fw-bold">
                        No employees found for this company
                    </td>
                </tr>
                {% endif %}

                </tbody>
            </table>
        </div>
    </div>
</div>

</body>
</html>
